# This configuration runs all continuous integration tests assuming a full local deployment (`make start-locally` and `make start-uss-mocks`)

v1:
    test_run:
        resources:
            resource_declarations:
                "$ref": resources.yaml#/all
        action:
            test_suite:
                resources:
                    adjacent_circular_flights_data: adjacent_circular_flights_data
                    adjacent_circular_storage_config: adjacent_circular_storage_config
                    kml_flights_data: kml_flights_data
                    kml_storage_config: kml_storage_config
                    service_providers: netrid_service_providers
                    observers: netrid_observers
                    evaluation_configuration: netrid_observation_evaluation_configuration
                    flight_planners: flight_planners
                    conflicting_flights: conflicting_flights
                    priority_preemption_flights: priority_preemption_flights
                    invalid_flight_auth_flights: invalid_flight_auth_flights
                    dss: dss
                    netrid_dss_instances: netrid_dss_instances
                suite_definition:
                    name: All tests for local deployment
                    resources:
                        adjacent_circular_flights_data: resources.netrid.FlightDataResource
                        adjacent_circular_storage_config: resources.netrid.FlightDataStorageResource
                        kml_flights_data: resources.netrid.FlightDataResource
                        kml_storage_config: resources.netrid.FlightDataStorageResource

                        service_providers: resources.netrid.NetRIDServiceProviders
                        observers: resources.netrid.NetRIDObserversResource
                        evaluation_configuration: resources.netrid.EvaluationConfigurationResource
                        flight_planners: resources.flight_planning.FlightPlannersResource
                        conflicting_flights: resources.flight_planning.FlightIntentsResource
                        priority_preemption_flights: resources.flight_planning.FlightIntentsResource
                        invalid_flight_auth_flights: resources.flight_planning.FlightIntentsResource
                        dss: resources.astm.f3548.v21.DSSInstanceResource

                        netrid_dss_instances: resources.astm.f3411.DSSInstancesResource
                    actions:
                        - test_suite:
                              suite_type: suites.interuss.generate_test_data
                              resources:
                                  adjacent_circular_flights_data: adjacent_circular_flights_data
                                  adjacent_circular_storage_config: adjacent_circular_storage_config
                                  kml_flights_data: kml_flights_data
                                  kml_storage_config: kml_storage_config
                          on_failure: Continue
                        - test_suite:
                              suite_type: suites.uspace.required_services
                              resources:
                                  conflicting_flights: conflicting_flights
                                  priority_preemption_flights: priority_preemption_flights
                                  invalid_flight_auth_flights: invalid_flight_auth_flights
                                  flight_planners: flight_planners
                                  dss: dss

                                  flights_data: adjacent_circular_flights_data
                                  service_providers: service_providers
                                  observers: observers
                                  evaluation_configuration: evaluation_configuration
                                  netrid_dss_instances: netrid_dss_instances
                          on_failure: Continue
    artifacts:
        tested_roles:
            report_path: tested_requirements.html
            roles:
                - name: Strategic Coordination role
                  requirement_set: astm.f3548.v21.scd
                  participants:
                      - uss1
                      - uss2
                - name: Service Provider role
                  requirement_set: astm.f3411.v19.service_provider
                  participants:
                      - uss1
                - name: Display Provider role
                  requirement_set: astm.f3411.v19.display_provider
                  participants:
                      - uss2
        "$ref": artifacts.yaml#/relative
